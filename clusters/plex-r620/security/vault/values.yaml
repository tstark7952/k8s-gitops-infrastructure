vault:
  global:
    enabled: true
    tlsDisable: false

  server:
    image:
      repository: hashicorp/vault
      tag: "1.15.2"

    # High Availability Mode
    ha:
      enabled: true
      replicas: 3
      raft:
        enabled: true
        setNodeId: true
        config: |
          ui = true
          listener "tcp" {
            tls_disable = 0
            address = "[::]:8200"
            cluster_address = "[::]:8201"
            tls_cert_file = "/vault/userconfig/vault-server-tls/tls.crt"
            tls_key_file = "/vault/userconfig/vault-server-tls/tls.key"
            tls_client_ca_file = "/vault/userconfig/vault-server-tls/ca.crt"
          }
          storage "raft" {
            path = "/vault/data"
          }
          service_registration "kubernetes" {}

    # Data Persistence
    dataStorage:
      enabled: true
      size: 10Gi
      storageClass: "local-path"

    # Audit Logging Persistence
    auditStorage:
      enabled: true
      size: 2Gi
      storageClass: "local-path"

    # TLS Configuration (Cert-Manager Integration)
    extraEnvironmentVars:
      VAULT_CACERT: /vault/userconfig/vault-server-tls/ca.crt

    # Mount the TLS secrets
    volumes:
      - name: vault-server-tls
        secret:
          secretName: vault-server-tls-secret
    volumeMounts:
      - name: vault-server-tls
        mountPath: /vault/userconfig/vault-server-tls
        readOnly: true

    # Ingress for UI
    ingress:
      enabled: true
      ingressClassName: traefik
      annotations:
        cert-manager.io/cluster-issuer: "step-ca-issuer"
        traefik.ingress.kubernetes.io/router.entrypoints: websecure
        traefik.ingress.kubernetes.io/router.tls: "true"
      hosts:
        - host: vault.plex.home.arpa
          paths: []
      tls:
        - secretName: vault-ui-tls
          hosts:
            - vault.plex.home.arpa

  # Sidecar Injector (for Apps)
  injector:
    enabled: true
    image:
      repository: hashicorp/vault-k8s
      tag: "1.3.0"
    resources:
      requests:
        memory: 256Mi
        cpu: 250m
      limits:
        memory: 512Mi
        cpu: 500m

  # UI Configuration
  ui:
    enabled: true
    serviceType: ClusterIP
    serviceNodePort: null
    externalPort: 8200

  # Monitoring
  csi:
    enabled: true
